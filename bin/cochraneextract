#!/usr/bin/env python
import argparse
import json
import os
import sys

sys.path.insert(0, os.path.dirname(sys.path[0]))

from lib import cochrane, pluck


if __name__ == '__main__':
	parser = argparse.ArgumentParser(
		description='Clean cochrane reviews')
	parser.add_argument('input', help='cochrane review jsonl file')
	args = parser.parse_args()
	for review in pluck.jsonl(args.input):
		try:
			id = cochrane.pubmed_id(review)
		except ValueError:
			continue
		randomization_risk = None
		for key, (risk, comment) in review['table'].iteritems():
			if 'random' in key.lower():
				if 'low' in risk.lower():
					randomization_risk = -1
				elif 'unclear' in risk.lower():
					randomization_risk = 0
				elif 'high' in risk.lower():
					randomization_risk = 1
				break
		if randomization_risk is not None:
			print json.dumps({
				'id': id,
				'randomization': randomization_risk,
			})
